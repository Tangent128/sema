#!./sema

local running = true

local c = 0

function command.incr(...)
	c = c + 1
	reply(c, ...)
	local status = run{"sleep", 1}
	reply(status)
end

function command.lsenv()
	for name in DEBUG.pairs(DEBUG.api) do
		reply(name)
	end
	reply "====="
	for name in DEBUG.pairs(_ENV) do
		reply(name)
	end
end

function command.quit()
	running = false
end

function command.down()
	setEvent("up", false)
	-- sleep doesn't die easily...
	signal(nil, DEBUG.signal.SIGKILL)
end

--DEBUG.print(threadName())

while running do

runIfUp{
	"sleep", "300"
}

DEBUG.print "looop!"

end

--DEBUG.print "done!"

