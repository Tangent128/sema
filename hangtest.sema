#!./sema

function command.hang(count)
	count = count or 400000 -- 400000 = over 1MB,probably exceeding write pipe buffer
	reply "starting"
	run{
		cmd"sleep 300"
	}
	reply(("done"):rep(count))
end

function command.ping()
	reply "pong"
end

function command.stop()
	setEvent "end"
end

function command.pollute()
	local c = command
	command = nil
	local s = command.status
	function command.status(...)
		reply "pollution"
		s(...)
	end
	command = c
end

waitEvent "end"

